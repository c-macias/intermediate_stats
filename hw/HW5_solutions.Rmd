---
title: "HW5"
author: "Frank Edwards"
date: "2/21/2020"
output: html_document
---

**Due via email by 10AM 2/28 to cs1215@scj.rutgers.edu**

```{r setup, include=FALSE}
library(tidyverse)
library(rethinking)
```

All three exercises below use the same data, data(foxes) (part of rethinking). The urban fox (Vulpes vulpes) is a successful exploiter of human habitat. Since urban foxes move in packs and defend territories, data on habitat quality and population density is also included. The data frame has five columns:

```{r}
data(foxes)
head(foxes)
d<-foxes
```

1. group: Number of the social group the individual fox belongs to 
2. avgfood: The average amount of food available in the territory 
3. groupsize: The number of foxes in the social group
4. area: Size of the territory
5. weight: Body weight of the individual fox

**1.** Fit two bivariate Gaussian regressions, using quap: (1) body weight as a linear function of territory size (area), and (2) body weight as a linear function of groupsize. Plot the results of these regressions, displaying the MAP regression line and the 89% interval of the mean. Is either variable important for predicting fox body weight?

```{r}
d<-d %>% 
  mutate(avgfood.s = as.vector(scale(avgfood)),
         groupsize.s = as.vector(scale(groupsize)),
         area.s = as.vector(scale(area)),
         weight.s = as.vector(scale(weight)))
### weight ~ area
mArea<-quap(alist(
  weight.s ~ dnorm(mu, sigma),
  mu<- a + b_a * area.s,
  a ~ dnorm(0, 0.2),
  b_a ~ dnorm(0, 0.5),
  sigma ~ dexp(1)
), data = d)
## weight ~ groupsize
mGroup<-quap(alist(
  weight.s ~ dnorm(mu, sigma),
  mu<- a + b_g * groupsize.s,
  a ~ dnorm(0, 0.2),
  b_g ~ dnorm(0, 0.5),
  sigma ~ dexp(1)
), data = d)
### extract results and plot
new_dat<-data.frame(groupsize.s = seq(-2, 2, length.out = 100),
                    area.s = seq(-2, 2, length.out = 100))

mArea_post<-link(mArea, data = new_dat)
mArea_mu<-apply(mArea_post, 2, mean)
mArea_PI<-apply(mArea_post, 2, PI)
mArea_plot<-data.frame(mu = mArea_mu,
                       mu_upr = mArea_PI[2,],
                       mu_lwr = mArea_PI[1,],
                       x = seq(-2, 2, length.out = 100),
                       model = "mArea")

mGroup_post<-link(mGroup, data = new_dat)
mGroup_mu<-apply(mGroup_post, 2, mean)
mGroup_PI<-apply(mGroup_post, 2, PI)
mGroup_plot<-data.frame(mu = mGroup_mu,
                       mu_upr = mGroup_PI[2,],
                       mu_lwr = mGroup_PI[1,],
                       x = seq(-2, 2, length.out = 100),
                       model = "mGroup")

plot_dat<-bind_rows(mArea_plot, mGroup_plot)

ggplot(plot_dat, 
       aes(x = x, y = mu, ymax = mu_upr, ymin = mu_lwr)) + 
  geom_line() + 
  geom_ribbon(alpha = 0.5) + 
  facet_wrap(~model)
```



**2.** Now fit a multiple linear regression with weight as the outcome and both area and groupsize as predictor variables. Plot the predictions of the model for each predictor, holding the other predictor constant at its mean. What does this model say about the importance of each variable? Why do you get different results than you got in the exercise just above?

```{r}
m2<-quap(alist(
  weight.s ~ dnorm(mu, sigma),
  mu<- a + b_g * groupsize.s + b_a * area.s,
  a ~ dnorm(0, 0.2),
  b_g ~ dnorm(0, 0.5),
  b_a ~ dnorm(0, 0.5),
  sigma ~ dexp(1)
), data = d)

coeftab(mArea, mGroup, m2)

x_seq<-seq(-2, 2, length.out = 100)

area_cfact<-sim(m2, data = 
                  data.frame(area.s = x_seq, 
                             groupsize.s = 0))
area_cfact_mu<-apply(area_cfact, 2, mean)
area_cfact_pi<-apply(area_cfact, 2, PI)

group_cfact<-sim(m2, data = 
                  data.frame(area.s = 0, 
                             groupsize.s = x_seq))
group_cfact_mu<-apply(group_cfact, 2, mean)
group_cfact_pi<-apply(group_cfact, 2, PI)

plot_dat_area<-data.frame(mu = area_cfact_mu, 
                          w_lwr = area_cfact_pi[1,],
                          w_upr = area_cfact_pi[2,],
                          variable = "Area")

plot_dat_group<-data.frame(mu = group_cfact_mu, 
                          w_lwr = group_cfact_pi[1,],
                          w_upr = group_cfact_pi[2,],
                          variable = "Groupsize")

plot_dat<-plot_dat_area %>% 
  bind_rows(plot_dat_group)

ggplot(plot_dat, aes(x = rep(x_seq, 2), y = mu,
                     ymin = w_lwr, ymax = w_upr)) + 
  geom_line() + 
  geom_ribbon(alpha = 0.5) + 
  facet_wrap(~variable)
```


**3.** Finally, consider the avgfood variable. Fit two more multiple regressions: (1) body weight as an additive function of avgfood and groupsize, and (2) body weight as an additive function of all three variables, avgfood and groupsize and area. Compare the results of these models to the previous models youâ€™ve fit, in the first two exercises. (a) Is avgfood or area a better predictor of body weight? If you had to choose one or the other to include in a model, which would it be? Support your assessment with any tables or plots you choose. (b) When both avgfood or area are in the same model, their effects are reduced (closer to zero) and their standard errors are larger than when they are included in separate models. Can you explain this result?

```{r}
m3<-quap(alist(
  weight.s ~ dnorm(mu, sigma),
  mu<- a + b_g * groupsize.s + b_f * avgfood.s,
  a ~ dnorm(0, 0.2),
  b_g ~ dnorm(0, 0.5),
  b_f ~ dnorm(0, 0.5),
  sigma ~ dexp(1)
), data = d)

m4<-quap(alist(
  weight.s ~ dnorm(mu, sigma),
  mu<- a + b_g * groupsize.s + b_f * avgfood.s + b_a * area.s,
  a ~ dnorm(0, 0.2),
  b_g ~ dnorm(0, 0.5),
  b_f ~ dnorm(0, 0.5),
  b_a ~ dnorm(0, 0.5),
  sigma ~ dexp(1)
), data = d)

coeftab(m2, m3, m4)
```

