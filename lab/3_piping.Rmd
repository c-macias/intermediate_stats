---
title: "practice_3"
author: "Christiane Schwarz"
date: "2/11/2020"
output: ioslides_presentation
---

## Today's lab: **gapminder data**

```{r gapminder, echo = TRUE, warning = F, message = F}
library(tidyverse)
library(gapminder)
data("gapminder")
str(gapminder)
```

## Data Exploration: Gapminder

- Use the following codes to obtain basic information: str(), names(), ncol(), 
length(), dim(), nrow(), summary(), head()
- Create plots 

## Data Exploration: Gapminder

```{r, echo = TRUE, fig.height = 4}
hist(gapminder$lifeExp)
```

## Data Exploration: Gapminder

```{r, echo= T}
table(gapminder$continent)
```

## Data Exploration: Gapminder

```{r, echo= TRUE}
continent_table<-table(gapminder$continent)
barplot(continent_table)
```

## Data Exploration: Gapminder

```{r, echo = TRUE}
plot(lifeExp ~ year, gapminder)
```

## Data Exploration: Gapminder

```{r, echo = TRUE}
plot(lifeExp ~ log(gdpPercap), gapminder)
```

## Exercise

- Create a data frame that includes only cases from **Rwanda** until the year 1979

(We should all remember this exercise from last week)

## Piping 

- useful to rewrite a fairly short linear sequence of operations
- the pipe operation: **%>%**
- Packages in tidyverse load **%>%** automatically
- Today's lab:  *gapminder* data

## Piping - exercise

- Subset the "gapminder" dataset including only year and life-expectancy, and obtain a summary of these two variables using the pipe operator

## Results

```{r, echo = TRUE}
gapminder %>%
  select(year, lifeExp) %>%
  summary()
```

## Piping- Exercise

- Obtain a tibble that includes only year and life expectancy in Cambodia (ONLY!)

## Results

```{r, echo= TRUE}
gapminder %>%
  filter(country== "Cambodia") %>%
  select(year, lifeExp)
```

## Exercise

- Create a new variable labeled "gdp" (*Gross domestic product*). GDP is the product of population and "gdpPercap", using the pipe operation

- Using the pipe operation, provide the median life expectancy based on continents in year 2007. 


## Results 1

```{r, echo == TRUE}
gapminder %>%
  mutate(gdp = pop* gdpPercap)
```

## Results 2

```{r, echo= TRUE}
gapminder %>%
    filter(year == 2007) %>%
    group_by(continent) %>%
    summarise(lifeExp = median(lifeExp))
```

## Exercises

- Look at the data from year 2007, sorted on life expectancy (use **arrange()**)
- Look at the data from year 2007, sorted on life expectancy in descending order. 

## Results

```{r, echo = TRUE}
gapminder %>%
  filter(year== 2007) %>%
  arrange(desc(lifeExp))
```


## Group_by

- You can use **group_by()** to produce similar results as **table()**

```{r, echo = TRUE}
gapminder %>%
  group_by(continent) %>%
  summarize (n= n())
```


## Group_ by: adding countries for each continent 
```{r, echo= TRUE}
gapminder %>%
  summarize(n=n(),
            n_countries = n_distinct(country))
```

## Functions that apply within summarize ()

- mean()
- median()
- var ()
- sd ()
- IQR ()
- min()
- max()


## merging data
- "superheros" 

```{r, echo= TRUE}
superheroes <- tibble::tribble(
       ~name, ~alignment,  ~gender,          ~publisher,
   "Magneto",      "bad",   "male",            "Marvel",
     "Storm",     "good", "female",            "Marvel",
  "Mystique",      "bad", "female",            "Marvel",
    "Batman",     "good",   "male",                "DC",
     "Joker",      "bad",   "male",                "DC",
  "Catwoman",      "bad", "female",                "DC",
   "Hellboy",     "good",   "male", "Dark Horse Comics"
  )
```

## merging data

- "publishers"
```{r, echo= TRUE}
publishers <- tibble::tribble(
  ~publisher, ~yr_founded,
        "DC",       1934L,
    "Marvel",       1939L,
     "Image",       1992L
  )
```

## inner_join (superheroes, publishers)

- inner_join (x,y): return all rows from x where there are matching values in y, and all columns from x and y. 
- If there are multiple matches between x and y, all combination of the matches are returned. 

## example

```{r, echo=TRUE}
(joined <- inner_join(superheroes, publishers))
```

## inner_join
Observe what had happened. 


## left_join (superheroes, publishers)

- left_join(x, y): return all rows from x, and all columns from x and y. If there are multiple matches between x and y, all combination of the matches are returned. **mutating join**

```{r, echo= TRUE}
(left <- left_join(superheroes, publishers))
```


## Exercise

- What can you observe when you use semi_join(x, y)?

- What can you observe when you use anti_join(x, y)? 

- What can you observe when you use full_join(x, y)? 


## Greate mini gapminder

```{r, echo=TRUE}
mini_gap <- gapminder %>% 
  filter(country %in% c("Belgium", "Canada", "United States", "Mexico"),
         year > 2000) %>% 
  select(-pop, -gdpPercap) %>% 
  droplevels() ## drop unused levels from factor variables 
mini_gap
```

## Greate a table of national foods

```{r, echo= TRUE}
food <- tribble(
        ~ country,    ~ food,
        "Belgium",  "waffle",
         "Canada", "poutine",
  "United States", "Twinkie"
)
food
```

## merge using left_join

- match(x, table): reports where the values in the key **x** appear in the lookup variable table. 

```{r, echo= TRUE}
mini_gap %>%
  left_join(food)
```



