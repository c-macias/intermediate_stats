---
title: "HW6 - Cleaning data"
author: "Frank Edwards"
date: "3/8/2019"
output: html_document
---

For this homework, you will clean the Fatal Encounters dataset. A recent pull of the data is located in "./HW/data/fe_1_25_19.csv". Feel free to go to the FE website (fatalencounters.org) and download the latest if you want. Just make sure to export it as .csv.

## Question 1

1. After reading in the data, give the resulting data frame columns a set of easy-to-use names

```{r}
rm(list=ls())
library(tidyverse)
######## read in police mort data
# ... attach and configure mortality file
fe_orig <- read_csv("./data/fe_1_25_19.csv")

# .... make names more user-friendly
names(fe_orig)<-c("id", "name", "age", "sex", "race", "URL", "death_date", 
                 "loc_address", "loc_city", "loc_state", "loc_zip", "loc_county", 
                 "loc_full_address", "Latitude", "Longitude", "agency", 
                 "cause_of_death","cause_description", "official_disposition", 
                 "news_url", "mental_illness", "video", "dateanddesc", 
                 "id_formula", "id2", "year")
```

2. Create a new data frame that contains the age, sex, race/ethnicity, state, date, and cause of death

```{r}
fe<-fe_orig%>%
  select(age, sex, race, loc_state, 
         death_date, cause_of_death)
```


## Question 2

1. Using the variable originally named `Date of injury resulting in death (month/day/year)` in the FE data, create a new variable for the year of the death. Don't cheat and use the already existing year variable in the data. 

```{r}
fe<-fe%>%
  mutate(year = str_sub(death_date, 7, 10))
## OR use tidyverse
library(lubridate)
fe$death_date<-mdy(fe$death_date)
fe$year<-year(fe$death_date)
```


2. Convert the age variable to a numeric variable that is equal to the number of years a person was when they died. You will have to first clean messy values.

```{r}
fe<-fe%>%
  mutate(age = ifelse(grepl("18 months", age), "1", age),
         age = ifelse(grepl("mon", age), "0", age),
         age = ifelse(grepl("days", age), "0", age),
         age = ifelse(age=="18-25", 21, age),
         age = ifelse(age=="46/53", 49, age),
         age = ifelse(age=="20s", 25, age),
         age = ifelse(age=="30s", 35, age),
         age = ifelse(age=="40s", 45, age),
         age = ifelse(age=="50s", 55, age),
         age = ifelse(age=="60s", 65, age),
         age = ifelse(age=="70s", 75, age),
         age = ifelse(age=="55.", 55, age),
         age = ifelse(age=="20s-30s", 30, age),
         age = ifelse(age=="40-50", 45, age),
         age = ifelse(age=="25-30", 27, age),
         age = ifelse(age=="24-25", 24, age),
         age = ifelse(age=="45 or 49", 47, age),
         age = ifelse(age=="25`", 25, age))%>%
  mutate(age = as.numeric(age)) ## if no coerced NAs, then we've got all the strings
```

3. Convert the sex variable into a three category variable with values F, M, T

```{r}
fe<-fe%>%
  mutate(sex = 
           case_when(
             str_sub(sex, 1, 1)=="F" ~ "F",
             str_sub(sex, 1, 1)=="M" ~ "M",
             str_sub(sex, 1, 1)=="T" ~ "T"))
```

4. Recode the race/ethnicity variable into more compact labels: black, white, latinx, a_pi, am_ind, m_e. Recode race unspecified to be equal to NA, not a character. Remeber that NA has special meaning in R.

```{r}
fe<-fe%>%mutate(race = case_when(
  race == "African-American/Black" ~ "black",
  race == "Asian/Pacific Islander" ~ "asian",
  race == "European-American/White" ~ "white",
  race == "Hispanic/Latino" ~ "latino", 
  race == "Hispanic/Latinio" ~ "latino", 
  race == "Middle Eastern" ~ "white", 
  race == "Native American/Alaskan" ~ "amind"))
```

5. Recode cause of death into 4 categories of your choosing

```{r}
fe<-fe%>%
  mutate(
    fe_cause_of_death = case_when(
      cause_of_death %in% c('Asphyxiated/Restrained',
                            'Beaten/Bludgeoned with instrument',
                            'Chemical agent/Pepper spray', 'Medical emergency', 
                            'Tasered') ~ "officer_force",
    cause_of_death == "Gunshot" ~ "gunshot",
    cause_of_death == "Vehicle" ~ "vehicle",
    cause_of_death %in% c("Burned/Smoke inhalation", "Drowned",
                          "Drug overdose", "Fell from a height",
                          "Other", "Stabbed", "Undetermined") ~ "other"))
```


## Question 3

1. Provide a visual that shows the distribution of your recoded cause of death variable

```{r}
ggplot(fe, aes(x = fe_cause_of_death)) + geom_bar()
```

2. Provide a visual that shows the distribution of victim age in the data

```{r}
ggplot(fe, aes(x = age)) + geom_density()
```

3. Provide a visual that shows the count of all deaths over time

```{r}
ts<-fe%>%
  group_by(year) %>% 
  summarise(count = n())%>%
  filter(year<2019)

ggplot(ts, aes(x = year, y = count)) + 
  geom_smooth() + 
  geom_point()
```

## Question 4

1. Add a new variable to your cleaned data using the variable "Official disposition of death...". This variable should be called "suicide" and will record whether the death was reported by police to be a suicide. 

```{r}
fe<-fe%>%
  bind_cols(fe_orig%>%select(official_disposition))%>%
  mutate(suicide = grepl("suicide", official_disposition))
```


2. Estimate a logistic regression that evaluates the probability that a victim was declared to have committed suicide. You may choose any variables in the cleaned data from Questions 1 or 2, or any other variables of your choosing. Briefly explain your choices and your model results. 

```{r}
fe$race<-relevel(factor(fe$race), "white")
fe<-fe%>%
  mutate(year = year - 2000)
m0<-glm(suicide ~ year, 
        data = fe, 
        family = "binomial")

m1<-glm(suicide ~ year + age, 
        data = fe, 
        family = "binomial")

m2<-glm(suicide ~ year + age + race, 
        data = fe, 
        family = "binomial")

BIC(m0); BIC(m1); BIC(m2)

library(broom)
tidy(m2)
```

Key conclusions from this model:

- Year + age + race is best fitting of models tested
- Suicides aren't clearly increasing or decreasing over time. 
- Likelihood of suicide increases with age
- Likelihood is highest for white people
