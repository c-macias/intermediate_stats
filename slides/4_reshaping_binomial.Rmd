---
title: "Reshaping data - Binary variables"
author: "Frank Edwards"
date: "2/15/2019"
output: binb::metropolis
---

```{r setup, echo = FALSE, message = FALSE}
library(tidyverse)
library(gapminder)
library(broom)
set.seed(1)

options(xtable.comment = FALSE)
theme_set(theme_minimal())
def.chunk.hook  <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(chunk = function(x, options) {
  x <- def.chunk.hook(x, options)
  ifelse(options$size != "normalsize", paste0("\\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
})
knitr::opts_chunk$set(warning=FALSE, message=FALSE, tidy = TRUE, size = "small")
```

# Review HW 3

# Reshaping data using the tidyverse

# Grouping and summarizing

## Evaluating the structure of the data

```{r, size = "scriptsize"}
head(gapminder)
```

How is this data structured?

What natural groupings are present in this data?

## Grouping and summarizing: by country

```{r, size = "tiny"}
gapminder%>%
  group_by(country)%>%
  summarise(mean_lifeExp = mean(lifeExp))
```

## Grouping and summarizing: by country (cont.)

```{r, size = "tiny"}
gapminder%>%
  group_by(country)%>%
  summarise(mean_lifeExp = mean(lifeExp), 
            max_lifeExp = max(lifeExp),
            min_lifeExp = min(lifeExp))
```

## Grouping and summarizing: by continent and year

```{r, size = "tiny"}
gapminder%>%
  group_by(continent, year)%>%
  summarise(mean_lifeExp = mean(lifeExp))
```

## Grouping and summarizing: by continent and year (cont.)

```{r, size = "tiny", fig.height = 3, fig.width = 6}
gapminder%>%
  group_by(continent, year)%>%
  summarise(mean_lifeExp = mean(lifeExp))%>%
  ggplot(aes(x=year, y=mean_lifeExp, col=continent)) +
  geom_line()
```

# Reshaping: gather and spread (long<->wide)

## Is this data long or wide?

```{r, size = "tiny"}
dat<-gapminder%>%
  group_by(continent, year)%>%
  summarise(mean_lifeExp = mean(lifeExp))
head(dat)
```

## Use spread() to make it wide by continent

```{r, size = "scriptsize"}
dat_wide<-dat%>%
  spread(key = continent, value = mean_lifeExp)
head(dat_wide)
```

## Use spread() to make it wide by year

```{r, size = "scriptsize"}
dat_wide<-dat%>%
  spread(key = year, value = mean_lifeExp)
head(dat_wide)
```

## Use gather() to make wide data long

```{r, size = "tiny"}
dat_long<-dat_wide%>%
  gather(key = "year", value = "mean_lifeExp", 
         "1952", "1957", "1962", "1967", "1972",
         "1977", "1982", "1992", "1997", "2002", 
         "2007")
head(dat_long)
```

## Use gather() to make wide data long with less code

```{r, size = "tiny"}
dat_long<-dat_wide%>%
  gather(key = "year", value = "mean_lifeExp",
         -continent)
head(dat_long)
```

# Break

# Binary/Bernoulli data

## Variables are sampled from probability distributions

Recall that a normally distributed random variable $y$ with mean $\mu$ and variance $\sigma^2$ can be expressed as:

$$y \sim Normal(\mu, \sigma^2) $$

## Parameters and shape

```{r}
norm_sim<-rnorm(10000, mean = 0, sd = 1)
qplot(norm_sim) + coord_cartesian(xlim = c(-10,10))
```

## Parameters and shape

```{r}
norm_sim<-rnorm(10000, mean = 0, sd = 3)
qplot(norm_sim) + coord_cartesian(xlim = c(-10,10))
```

## Parameters and shape

```{r}
norm_sim<-rnorm(10000, mean = 2, sd = 3)
qplot(norm_sim) + coord_cartesian(xlim = c(-10,10))
```

## All regressions model outcomes as random variables

Recall that a linear regression treats $y$ as a random variable with mean expectation such that each $y_i$ can be modeled as

$$y_i = X\beta + \varepsilon $$

or 

$$y \sim Normal(X\beta, \sigma^2) $$

So each observation $y_i$ is treated as a draw from a Normal distribution with $\mu = X\beta$ and variance $\sigma^2$. 

## Does one size fit all?

Does the normal model describe all phenomena we study well?

## An alternative: the Bernoulli distribution for binary data

The Bernoulli distribution for random variable $X$

$$\Pr(X=1)=p=1-\Pr(X=0)$$

Paramterization:

$$ y \sim Bernoulli(p) $$

## Properties of random binary variables

If $y$ is an i.i.d. Bernoulli variable with probability $p$:

$$y \sim Bernoulli(p)$$

$$E(y) = p$$ 
$$Var(y) = p(1-p)$$ 

## Recall the central limit theorem

```{r, echo = FALSE}
x1<-rnorm(5, 0,1); x2<-rnorm(30, 0, 1); x3<-rnorm(100, 0, 1); x4<-rnorm(10000, 0,1)
par(mfrow=c(2,2))
plot(density(x1))
plot(density(x2))
plot(density(x3))
plot(density(x4))
```

## A Bernoulli variable as a coin flip

```{r}
flip_n_coins<-function(n){
  rbinom(n, 1, 0.5)
  }
flip_n_coins(10)
```

## What does the distribution of a binary variable look like? 

```{r, fig.height=4}
y<-flip_n_coins(5)
hist(y)
abline(v = mean(y), col = 2)
```

## What does the distribution of a binary variable look like? 

```{r, fig.height=4}
y<-flip_n_coins(10)
hist(y)
abline(v = mean(y), col = 2)
```

## What does the distribution of a binary variable look like? 

```{r, fig.height=4}
y<-flip_n_coins(100)
hist(y)
abline(v = mean(y), col = 2)
```

## What does the distribution of a binary variable look like? 

```{r, fig.height=4}
y<-flip_n_coins(100000)
hist(y)
abline(v = mean(y), col = 2)
```

## Recap

A binary variable $y$ takes on the values 1 or 0, with probability 

$$Pr(y=1) = p$$


